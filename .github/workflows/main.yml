name: Internship Scraper Cron

on:
  schedule:
    # 9 AM IST ‚Üí 3:30 AM UTC
    - cron: "30 3 * * *"
    # 6 PM IST ‚Üí 12:30 PM UTC
    - cron: "30 12 * * *"
    # Midnight IST ‚Üí 6:30 PM UTC
    - cron: "30 18 * * *"
  workflow_dispatch:  # allow manual run from Actions tab

jobs:
  ping-flask-app:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Flask app with retries
        run: |
          echo "üîÑ Pinging Flask app..."
          URL="https://internship-bot-bilc.onrender.com/health"

          for i in {1..5}; do
            response=$(curl -s -w "\nHTTP_STATUS:%{http_code}\n" "$URL" || true)
            echo "$response"

            status=$(echo "$response" | grep "HTTP_STATUS" | cut -d: -f2)

            if [ "$status" -eq 200 ]; then
              echo "‚úÖ Flask app responded successfully."
              exit 0
            fi

            echo "‚ö†Ô∏è Attempt $i failed with status $status. Retrying in 20s..."
            sleep 20
          done

          echo "‚ùå App did not respond after 5 retries."
          exit 1


